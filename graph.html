<script>
  // This function converts the call stack string into an array of function calls
  function parseCallStack(data) {
    return data.map(item => {
      // Split the call stack string by ' -> ' and remove any empty strings
      const callStack = item.call_stack.split(' -> ').filter(Boolean);
      return { ...item, callStack };
    });
  }

  // Generate the graph based on the call stack
  function generateGraphFromCallStack(data) {
    const parsedData = parseCallStack(data);
    const mermaidViewer = document.getElementById("mermaid-viewer");

    parsedData.forEach((item, index) => {
      if (item.callStack.length > 0) {
        let graphDefinition = `graph LR;\n`;
        item.callStack.forEach((functionName, idx) => {
          const nextFunctionName = item.callStack[idx + 1];
          graphDefinition += `id${index}_${idx}("${functionName.replace(/"/g, "&quot;")}")\n`;
          if (nextFunctionName) {
            graphDefinition += `id${index}_${idx} --> id${index}_${idx + 1}\n`;
          }
        });

        // Add the graph title
        const graphTitle = document.createElement("h3");
        graphTitle.textContent = `Log ID: ${item.log_id}`;
        mermaidViewer.appendChild(graphTitle);

        // Add the graph to the viewer
        const graphDiv = document.createElement("div");
        graphDiv.className = "mermaid";
        graphDiv.innerHTML = graphDefinition; // Use innerHTML to insert the graph definition
        mermaidViewer.appendChild(graphDiv);
        mermaidViewer.appendChild(document.createElement("br"));
      }
    });

    // Initialize Mermaid to render the graphs
    mermaid.init(undefined, ".mermaid");
  }

  // Call the function to generate graphs from call stack
  generateGraphFromCallStack(data);
</script>

